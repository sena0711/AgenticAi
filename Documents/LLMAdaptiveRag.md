# 📚 Adaptive RAG (Retrieval-Augmented Generation) 정리

## 개요

**Adaptive RAG**는 기존 RAG 시스템에 **상황 대응력**과 **자기 판단 능력**을 더한 진화된 구조입니다. 사용자의 질문이 부정확하거나, 검색 결과가 없거나, 답변이 잘못되었을 때도 **스스로 판단하고 수정하며 최적의 응답을 생성**하는 지능형 RAG 시스템입니다.

---

## 1. 기존 RAG 구조

```
[사용자 입력]
     ↓
[Retriever: 검색] → 관련 문서 추출
     ↓
[LLM Generator: 생성] → 문서 기반 응답
```

### ✅ 장점
- 외부 문서 기반 응답 가능
- 최신 정보, 도메인 지식 활용

### ⚠️ 한계
- 검색 실패 시 응답 불가
- 질문이 부정확하면 실패율 증가
- 잘못된 응답 시 자체 수정 불가능

---

## 2. Adaptive RAG란?

> "상황에 맞게 스스로 행동을 선택하는 RAG 시스템"

### 핵심 특징
- 검색 실패 시 질문을 재구성하거나 반려
- 잘못된 응답이면 Reflection으로 재검토 및 재생성
- 목적에 맞게 액션 선택: 🔁 재질문 / 🔍 재검색 / ✏ 수정 / ❌ 중단 등

---

## 3. 작동 흐름 예시

```
[사용자 질문]
   ↓
[1차 검색 시도 → 결과 없음]
   ↓
[질문 재작성 or 유사 질문 탐색]
   ↓
[2차 검색 → 결과 있음]
   ↓
[응답 생성 → Self-Check → 수정 여부 판단]
   ↓
[최종 응답 전달]
```

---

## 4. Adaptive RAG 구성 요소

| 컴포넌트 | 설명 |
|----------|------|
| **LLM Agent** | 상황 판단, 질문 수정, 검색 트리거, 오류 수정 담당 |
| **Retriever** | 문서 검색 담당 (벡터 검색, 키워드 등) |
| **Memory / Log** | 검색 히스토리 및 응답 흐름 추적 |
| **Reflection Module** | 생성 결과 평가 및 수정 판단 |
| **Rewriting Module** | 질문이나 프롬프트 자동 재구성 |

---

## 5. 주요 전략 / 기술

| 전략 | 설명 |
|--------|------|
| **Query Rewriting** | 검색 실패 시 질문을 자동으로 다시 작성 |
| **Self-Reflection** | 답변 후 오류를 검토하고 수정 |
| **Fallback 전략** | 검색 실패 시 백업 데이터 사용 또는 다른 Retriever 선택 |
| **Tool-Use Agent** | 검색, 판단, 생성 등의 도구를 선택적으로 사용하는 Agent 시스템 |
| **Multi-Hop RAG** | 여러 단계에 걸쳐 문서를 검색하고 통합 |
| **Corrective RAG** | 질문의 정답이 문서 저장소에 없을 경우, **질문을 분석하고 외부(예: 웹)에서 검색**하여 보완하는 확장형 전략 |

---

## 6. 실제 적용 시나리오

- 사내 문서 기반 QA (문서 누락되었을 때 질문 유도)
- 헬프데스크 챗봇 (모호한 질문 → 명확화 후 응답)
- 법률/의료 등 정답의 정확성이 중요한 분야
- 고객 응대 챗봇에서 **답이 없을 경우 재질문하거나 외부 정보까지 검색하는 전략**이 필요할 때

---

## 7. 관련 프레임워크 / 기술

| 이름 | 설명 |
|------|------|
| **ReAct + RAG** | reasoning + action + 검색 결합 구조 |
| **LangGraph** | 상태 기반 LLM workflow orchestration |
| **CrewAI / AutoGen** | 에이전트 기반의 검색-판단-생성 루프 가능 |
| **LlamaIndex + SelfQuery Retriever** | 의미 기반 질문 수정 및 적응 검색 |
| **Corrective RAG** | 외부 소스를 통한 정보 보강 및 지속적 보완 루프 적용 |

---

## 8. 요약

> **Adaptive RAG = 지식 검색 + 자기 판단 + 반응형 액션 조합**

- RAG의 한계를 보완하여 **더 강력한 응답 품질** 제공
- 다양한 Reasoning 및 Multi-Agent 구조와 잘 결합됨
- 질문 자체의 품질과 상황을 고려하여 반응하는 지능형 QA 시스템
- **Corrective RAG**는 Adaptive RAG의 확장형으로, 정보가 없을 때 **질문을 진단하고 외부 자원까지 활용**한다는 점에서 강력한 보완책이 될 수 있음

---

## 9. Adaptive RAG vs Corrective RAG 요약 비교

| 상황 | 전략 | 주요 액션 | 설명 |
|------|--------|------------|--------|
| 📄 문서에 정답이 있으나 질문이 부정확 | **Adaptive RAG** | 🔁 질문 재작성 / ✏ 의미 수정 | 질문을 리프레이밍하여 재검색 후 정답 생성 |
| ❓ 문서에도 정답이 없음 | **Corrective RAG** | 🔍 외부 검색 / 🧠 추론 / 🌐 웹 활용 | 질문의 의미를 분석하고 외부 자원에서 보완 정보 수집 후 응답 |

→ 두 전략은 **서로 보완적이며 함께 사용될 때 강력한 검색-생성 시스템**을 구성할 수 있습니다.

